#Include "Libs/BigBang1112/Layers.Script.txt" as Layers
#Include "Libs/BigBang1112/Manialink.Script.txt" as Manialink
#Include "Libs/BigBang1112/Map.Script.txt" as Map
#Include "Libs/BigBang1112/Settings.Script.txt" as Settings

#Include "Libs/Challenge/Loading.Script.txt" as Loading

#Const C_Manialink "Media/Manialinks/Sandbox/Top"

Void Init() {
	Layers::Create("Top", Manialink::FromFile(C_Manialink, True, ["TextAnimation", "Audio"], Settings::Get().Theme));
}

Void Start() {
	Layers::Show("Top", True);
}

declare Boolean VisitMap;
declare Boolean Authorize;

Void Event(CManiaAppEvent _Event) {
	declare Event <=> _Event;

	if(Event.Type == CManiaAppEvent::EType::LayerCustomEvent) {
		switch(Event.CustomEventType) {
			case "Button_Skins": {
				VisitMap = True;
			}
			case "Button_Authorize": {
				Authorize = True;
			}
		}
	}
}

Void Async() {

}

Void Loop() {
	if(VisitMap) {
		wait(TitleControl.IsReady);
		declare Map = Map::MapInfo("SkinSelect.Map.Gbx");
		Loading::SetLoading(Map.CollectionName, Map);
		TitleControl.PlayMap(Map.FileName, "TrackMania/SkinSelect.Script.txt", "");
		VisitMap = False;
	}
	
	if(Authorize) {
		Layers::Hide("Menu", True);
		Layers::Hide("Quickplay", True);
		Layers::Hide("Top", True);
		Layers::Hide("Playsessions", True);
		Layers::Hide("News", True);
		Layers::Show("AuthBeta", True);
		Authorize = False;
	}
}