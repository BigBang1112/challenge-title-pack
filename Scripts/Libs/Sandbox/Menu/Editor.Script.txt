#Include "TextLib" as TextLib

#Include "Libs/BigBang1112/Layers.Script.txt" as Layers
#Include "Libs/BigBang1112/Manialink.Script.txt" as Manialink
#Include "Libs/BigBang1112/File.Script.txt" as File
#Include "Libs/BigBang1112/Map.Script.txt" as Map
#Include "Libs/BigBang1112/Settings.Script.txt" as Settings

#Include "Libs/Challenge/Loading.Script.txt" as Loading

#Const C_Manialink "Media/Manialinks/Sandbox/Editor"

Void Init() {
	Layers::Create("Editor", Manialink::FromFile(C_Manialink, True, ["TextAnimation", "Audio"], Settings::Get().Theme));
}

Void Start() {

}

declare Boolean StartTest;

Void Event(CManiaAppEvent _Event) {
	declare Event <=> _Event;

	if(Event.Type == CManiaAppEvent::EType::LayerCustomEvent) {
		switch(Event.CustomEventType) {
			case "Test": {
				if(TitleControl.IsReady) {
					StartTest = True;
				}
			}
			case "Button_CreateChallenge_Back": {
				Layers::Show("Menu", True);
				Layers::Show("Quickplay", True);
				Layers::Show("Top", True);
				Layers::Show("Playsessions", True);
				Layers::Show("News", True);
				Layers::Hide("Editor", True);
				Layers::SendEvent("Notification", "Position", ["150 55"]);
			}
		}
	}
}

Void Async() {

}

Void Loop() {
	if(StartTest) {
		declare Map::SMapInfo OriginalMapInfo for LocalUser;
		OriginalMapInfo = Map::MapInfo("2FRV EXCLUSIVE 001.Map.Gbx");
		Loading::SetLoading(OriginalMapInfo.CollectionName, OriginalMapInfo.MapUid);
		TitleControl.EditNewMapFromBaseMap(OriginalMapInfo.FileName, "", "", "Challenge.Script.txt", "Modifier.Script.txt","""<settings>
	<setting name="S_Build" type="boolean" value="True"/>
	<setting name="S_TestMode" type="boolean" value="True"/>
</settings>""");
		
		StartTest = False;
	}
	
	if(TitleControl.IsReady) {
		Layers::SendEvent("Editor", "Loading_End_Test", []);
	}
}